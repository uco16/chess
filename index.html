<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chess</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/png" href="client/pieces/knight_left.png">
    <meta charset="utf-8">
  </head>

  <body>
    <script src="./client/modules/header.js"></script>

    <div class="gamewindow">
      <div id="chessboard">
        <! -- sketch.js will draw inside here -->
      </div>
      <div class="movewindow">
        <h2>Moves</h2>
        <ol id="moves" style="overflow:auto"></ol>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="client/p5.js"></script>
    <script src="client/p5.sound.min.js"></script>
    <script src="client/sketch.js"></script>
    <!-- the script tags seem to share their namespace,
      socket is declared in sketch.js, should probably do this more consistently -->
    <script src="client/modules/isLegal.js"></script>
    <script>
      function clearMoveList() {
	var moves = document.getElementById('moves');
	if (moves.hasChildNodes()) {
	  console.log(moves.childNodes);
	  for (let i = 0; i < moves.childNodes.length; i++) {
	    moves.removeChild(moves.childNodes[i]);
	  }
	}
      }

      function addtoMoveList(initial, final) {
	let moves = document.getElementById('moves');
	let item = document.createElement('li');
	// check if isScrolledDown before we add another move to the list
	let isScrolledDown = (moves.scrollHeight - moves.clientHeight <= moves.scrollTop + 1);

	item.textContent = `[${initial}] to [${final}]`;
	moves.appendChild(item);

	if (isScrolledDown) {
	  moves.scrollTop = moves.scrollHeight - moves.clientHeight;
	}
      }

      function numMovesPlayed() {
	var moves = document.getElementById('moves');
	return moves.childNodes.length;
      }

      socket.on('match', (color) => {
	clearMoveList();
	startGame(color);  // function defined in sketch.js
      });
      
      socket.on('move', (initial, final) => {
	addtoMoveList(initial, final);
      });

      socket.onAny((event, ...args) => {
	console.log('index: socket received ', event, args);
      });
    </script>
  </body>
</html>
